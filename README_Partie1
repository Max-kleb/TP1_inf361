Partie 1 : Script Bash d'automatisation
ğŸ“‹ Description
Script Bash complet pour automatiser la crÃ©ation d'utilisateurs sur un serveur Linux avec toutes les configurations de sÃ©curitÃ© et restrictions nÃ©cessaires.

ğŸ¯ FonctionnalitÃ©s implÃ©mentÃ©es
âœ… Exigences de base
CrÃ©ation de groupe personnalisÃ© passÃ© en paramÃ¨tre
CrÃ©ation d'utilisateurs avec :
Nom d'utilisateur
Informations complÃ¨tes (nom complet, tÃ©lÃ©phone, email)
Shell prÃ©fÃ©rÃ© (vÃ©rification + installation automatique)
RÃ©pertoire personnel
âœ… SÃ©curitÃ©
Groupe students-inf-361 : Tous les utilisateurs ajoutÃ©s
Hachage SHA-512 des mots de passe
Changement obligatoire du mot de passe Ã  la premiÃ¨re connexion
AccÃ¨s sudo avec restriction de la commande su
âœ… Personnalisation
Message de bienvenue personnalisÃ© affichÃ© Ã  chaque connexion
Quotas disque : Maximum 15 Go par utilisateur
Limites mÃ©moire : Maximum 20% de la RAM par processus
âœ… TraÃ§abilitÃ©
Journalisation complÃ¨te avec date, heure et dÃ©tails de chaque opÃ©ration
ğŸ“¦ Structure des fichiers
partie-1-bash/
â”œâ”€â”€ README.md                 # Ce fichier
â”œâ”€â”€ create_users.sh           # Script principal
â”œâ”€â”€ logs/                     # RÃ©pertoire des logs (crÃ©Ã© automatiquement)
â”‚   â””â”€â”€ user_creation_*.log
â””â”€â”€ test_users.txt           # Fichier de test (optionnel)
ğŸ”§ PrÃ©requis
SystÃ¨me
Ubuntu 20.04+ / Debian 10+ / CentOS 8+
AccÃ¨s root ou sudo
DÃ©pendances
bash
# Installer les outils nÃ©cessaires
sudo apt update
sudo apt install -y quota libpam-modules

# Activer les quotas sur la partition /home
sudo nano /etc/fstab
# Ajouter usrquota,grpquota aux options de montage
# Exemple: UUID=xxx /home ext4 defaults,usrquota,grpquota 0 2

# Remonter et initialiser les quotas
sudo mount -o remount /home
sudo quotacheck -cugm /home
sudo quotaon /home
ğŸš€ Utilisation
1. PrÃ©paration
bash
# Rendre le script exÃ©cutable
chmod +x create_users.sh

# VÃ©rifier le format du fichier users.txt
cat users.txt
2. Format du fichier users.txt
text
username;password;Full Name;+237XXXXXXXXX;email@domain.cm;/bin/bash
alice;P@ssw0rd123;Alice Kamga;+237698765432;alice@uy1.cm;/bin/bash
bob;Secure456!;Bob Nguema;+237677889900;bob@uy1.cm;/bin/zsh
Champs (sÃ©parÃ©s par ;):

username : Nom d'utilisateur (obligatoire)
password : Mot de passe initial (obligatoire)
Full Name : Nom complet
phone : NumÃ©ro de tÃ©lÃ©phone
email : Adresse email
shell : Chemin du shell prÃ©fÃ©rÃ©
3. ExÃ©cution
bash
# Syntaxe gÃ©nÃ©rale
sudo ./create_users.sh <nom_du_groupe> <fichier_utilisateurs>

# Exemple
sudo ./create_users.sh students-inf-361 ../users.txt
4. Sortie attendue
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         SCRIPT DE CRÃ‰ATION AUTOMATISÃ‰E D'UTILISATEURS         â•‘
â•‘                  UNIVERSITÃ‰ DE YAOUNDÃ‰ I                       â•‘
â•‘            INF 3611 - Administration SystÃ¨mes et RÃ©seaux       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ VÃ©rifications prÃ©liminaires rÃ©ussies

ğŸ”§ Configuration du groupe...
âœ“ Groupe students-inf-361 crÃ©Ã©
âœ“ Restrictions sudo configurÃ©es

ğŸ“„ Traitement du fichier utilisateurs...

ğŸ”§ CrÃ©ation de l'utilisateur: alice
  âœ“ Compte crÃ©Ã©
  âœ“ Mot de passe configurÃ©
  âœ“ Changement obligatoire activÃ©
  âœ“ Message de bienvenue configurÃ©
  âœ“ Limites mÃ©moire configurÃ©es
  âœ“ Configuration complÃ¨te

...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… RÃ©sumÃ© de l'exÃ©cution:
   â€¢ Utilisateurs crÃ©Ã©s: 6
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Script terminÃ© avec succÃ¨s!
ğŸ“‹ Consultez le log pour plus de dÃ©tails: ./logs/user_creation_20251215_143022.log
ğŸ” VÃ©rification
Tester les crÃ©ations
bash
# VÃ©rifier qu'un utilisateur existe
id alice

# VÃ©rifier le groupe
getent group students-inf-361

# VÃ©rifier les informations complÃ¨tes
getent passwd alice

# Tester la connexion locale
ssh alice@localhost
# Vous devrez changer le mot de passe Ã  la premiÃ¨re connexion

# VÃ©rifier les quotas
sudo quota -u alice

# VÃ©rifier les limites
su - alice
ulimit -a
VÃ©rifier les restrictions sudo
bash
# Se connecter en tant qu'utilisateur
su - alice

# Tester sudo (devrait fonctionner)
sudo ls /root

# Tester su (devrait Ãªtre refusÃ©)
su -
# Sortie attendue: Sorry, user alice is not allowed to execute '/bin/su -' as root
Consulter les logs
bash
# Voir le dernier log crÃ©Ã©
ls -lt logs/
cat logs/user_creation_*.log

# Filtrer les erreurs
grep ERROR logs/user_creation_*.log

# Filtrer les succÃ¨s
grep "crÃ©Ã© avec succÃ¨s" logs/user_creation_*.log
ğŸ” DÃ©tails des configurations
1. Hachage des mots de passe (SHA-512)
Le script utilise chpasswd -c SHA512 pour hasher les mots de passe avec l'algorithme SHA-512, qui est l'un des plus sÃ©curisÃ©s.

bash
echo "$username:$password" | chpasswd -c SHA512
2. Restriction de la commande su
Fichier crÃ©Ã© : /etc/sudoers.d/students-inf-361

%students-inf-361 ALL=(ALL:ALL) ALL, !/bin/su, !/usr/bin/su
Les utilisateurs peuvent utiliser sudo mais pas su.

3. Quotas disque (15 Go)
bash
setquota -u username 15728640 15728640 0 0 /home
Soft limit = Hard limit = 15 GB (en blocs de 1K)

4. Limites mÃ©moire (20% RAM)
Fichier crÃ©Ã© : /etc/security/limits.d/username.conf

username soft rss 20% de RAM totale
username hard rss 20% de RAM totale
5. Message de bienvenue
Fichier : ~/WELCOME.txt pour chaque utilisateur
AffichÃ© automatiquement via ~/.bashrc
Contient : informations du compte, rÃ¨gles de sÃ©curitÃ©, quotas
âš ï¸ Gestion des erreurs
Le script gÃ¨re intelligemment :

Shell inexistant : Tentative d'installation automatique, sinon /bin/bash
Utilisateur existant : Avertissement, pas de modification
Groupe existant : Avertissement, utilisation du groupe existant
Quotas non supportÃ©s : Avertissement, continue sans quotas
Ligne invalide : IgnorÃ©e avec log d'erreur
ğŸ“Š Format des logs
[2025-12-15 14:30:22] [INFO] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2025-12-15 14:30:22] [INFO] DÃ‰BUT DE L'EXÃ‰CUTION DU SCRIPT
[2025-12-15 14:30:22] [INFO] Date: 2025-12-15 14:30:22
[2025-12-15 14:30:22] [INFO] Groupe cible: students-inf-361
[2025-12-15 14:30:22] [INFO] Fichier source: users.txt
[2025-12-15 14:30:23] [INFO] Groupe students-inf-361 crÃ©Ã© avec succÃ¨s
[2025-12-15 14:30:23] [INFO] CrÃ©ation de l'utilisateur: alice
[2025-12-15 14:30:24] [INFO] âœ“ Utilisateur alice crÃ©Ã© et configurÃ© avec succÃ¨s
...
ğŸ› DÃ©pannage
Erreur: "Permission denied"
bash
# S'assurer d'exÃ©cuter avec sudo
sudo ./create_users.sh students-inf-361 users.txt
Erreur: "quota: command not found"
bash
# Installer les outils de quotas
sudo apt install -y quota
Les quotas ne fonctionnent pas
bash
# VÃ©rifier que les quotas sont activÃ©s
sudo quotaon -p /home

# Si dÃ©sactivÃ©s, les activer
sudo quotaon /home
Le shell zsh/fish n'est pas installÃ©
Le script tentera de l'installer automatiquement. Si Ã©chec :

bash
# Installation manuelle
sudo apt install -y zsh fish
Message de bienvenue ne s'affiche pas
bash
# VÃ©rifier que le fichier existe
ls -la ~username/WELCOME.txt

# VÃ©rifier .bashrc
cat ~username/.bashrc | grep WELCOME
ğŸ’¡ AmÃ©liorations possibles
Validation avancÃ©e : VÃ©rifier la complexitÃ© des mots de passe
Format CSV/YAML : Support de formats supplÃ©mentaires
Notifications : Envoyer un email aprÃ¨s crÃ©ation (voir Partie 2)
Backup : Sauvegarder les configurations avant modification
Mode dry-run : Simuler sans crÃ©er
ğŸ“š RÃ©fÃ©rences
useradd manual
chpasswd manual
sudoers manual
quota manual
limits.conf
âœ… Checklist de tests
 Script s'exÃ©cute sans erreur
 Groupe crÃ©Ã© correctement
 Utilisateurs crÃ©Ã©s avec bon shell
 Mots de passe hachÃ©s (vÃ©rifier /etc/shadow)
 Changement de mot de passe forcÃ©
 sudo fonctionne
 su est bloquÃ©
 Message de bienvenue s'affiche
 Quotas configurÃ©s (vÃ©rifier avec quota -u username)
 Limites mÃ©moire actives
 Logs crÃ©Ã©s et complets
ğŸ‘¤ Auteur
Ã‰tudiant Licence 3 Informatique - UniversitÃ© de YaoundÃ© I
Cours: INF 3611 - Administration SystÃ¨mes et RÃ©seaux

